

var AskRedditModule = function() {
  var self = this;
  self.client = null;

  self.AskRedditLib = require('./AskReddit.lib');

  self.askRedditListener = function(from, to, message) {
    if(message == '!question') {
      if(to == this.opt.nick) {
        to = from;
      }

      self.client.say(to, 'Let me think..');
      self.AskRedditLib.getRandomQuestion(function(q) {
        if(q) {
          self.client.say(to, q.question); //  + ' - ' + q.url
        }
        else {
          self.client.say(to, "I'm out of ideas.. sorry!");
        }
      });

    }
  };
  
  /**
   * Unloads all listeners
  */
  self.unload = function(client) {
    client.removeListener('message', self.askRedditListener);

    delete require.cache[require.resolve('./AskReddit.lib')];
  };

  /**
   * Loads all listeners
  */
  self.load = function(client) {
    self.client = client;
    self.AskRedditLib = require('./AskReddit.lib');

    client.addListener('message', self.askRedditListener);
  };

};

module.exports = new AskRedditModule();
